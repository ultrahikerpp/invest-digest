<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ultra Investment Digest｜財經投資頻道重點摘要</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link
    href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Noto+Sans+TC:wght@400;500;700&display=swap"
    rel="stylesheet">
  <!-- Prevent flash of wrong theme -->
  <script>
    (function () {
      var saved = localStorage.getItem('theme');
      var theme = (saved === 'light' || saved === 'dark')
        ? saved
        : (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
      if (theme === 'light') document.documentElement.setAttribute('data-theme', 'light');
    })();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    /* ─────────────────────────────────────────────────────────
       Design System: Gen Z Dark Gradient
       Colours match card_generator.py exactly:
         C_BG   = #080A1A  C_BG2  = #160C32
         C_VIBE1= #6366F1  C_VIBE2= #A855F7  C_VIBE3= #EC4899
       Typography modular scale (Major Third 1.250):
         12 · 13 · 14 · 16 · 17 · 20 · 24 · 28
    ───────────────────────────────────────────────────────── */

    /* ── Dark mode (default) ── */
    :root {
      --bg: #080A1A;
      --bg2: #160C32;
      --surface: #10122A;
      --surface2: #0D0F22;

      --border: rgba(99, 102, 241, 0.18);
      --border-hover: rgba(168, 85, 247, 0.45);

      --vibe1: #6366F1;
      --vibe2: #A855F7;
      --vibe3: #EC4899;
      --vibe1-lt: rgba(99, 102, 241, 0.14);
      --vibe1-dk: #4F46E5;

      --primary: #6366F1;
      --primary-lt: rgba(99, 102, 241, 0.14);
      --primary-dk: #4F46E5;

      --text: #F1F5F9;
      --text-muted: #94A3B8;
      --text-dim: #64748B;

      --green: #10B981;
      --green-lt: rgba(16, 185, 129, 0.12);
      --red: #F43F5E;
      --red-lt: rgba(244, 63, 94, 0.15);

      --shadow-sm: 0 2px 6px rgba(0, 0, 0, .45);
      --shadow-md: 0 6px 24px rgba(0, 0, 0, .55), 0 0 24px rgba(99, 102, 241, .10);
      --shadow-lg: 0 16px 56px rgba(0, 0, 0, .65), 0 0 48px rgba(99, 102, 241, .16);

      --radius: 14px;
      --radius-sm: 9px;
      --sans: 'IBM Plex Sans', 'Noto Sans TC', 'PingFang TC', sans-serif;

      /* Theme-specific tokens (dark defaults) */
      --header-bg: rgba(8, 10, 26, 0.90);
      --sidebar-bg: rgba(16, 18, 42, 0.85);
      --modal-overlay-bg: rgba(4, 5, 16, 0.78);
      --modal-footer-bg: rgba(13, 15, 34, 0.6);
      --sidebar-backdrop-bg: rgba(4, 5, 16, 0.55);
      --disclaimer-bg: rgba(168, 85, 247, 0.08);
      --disclaimer-border: rgba(168, 85, 247, 0.22);
      --disclaimer-color: #C4B5FD;
      --text-strong: #C4B5FD;
      --text-code: #A78BFA;
      --code-bg: #0D0F22;
    }

    /* ── Light mode overrides ── */
    html[data-theme="light"] {
      --bg: #F8FAFC;
      --bg2: #EEF2FF;
      --surface: #FFFFFF;
      --surface2: #F1F5F9;

      --border: rgba(99, 102, 241, 0.18);
      --border-hover: rgba(168, 85, 247, 0.5);

      --vibe1-lt: rgba(99, 102, 241, 0.10);

      --text: #0F172A;
      --text-muted: #475569;
      --text-dim: #64748B;

      --green: #059669;
      --green-lt: rgba(5, 150, 105, 0.10);
      --red: #DC2626;
      --red-lt: rgba(220, 38, 38, 0.10);

      --shadow-sm: 0 2px 6px rgba(0, 0, 0, .08);
      --shadow-md: 0 6px 24px rgba(0, 0, 0, .10), 0 0 24px rgba(99, 102, 241, .07);
      --shadow-lg: 0 16px 56px rgba(0, 0, 0, .14), 0 0 48px rgba(99, 102, 241, .08);

      /* Theme-specific tokens (light) */
      --header-bg: rgba(255, 255, 255, 0.92);
      --sidebar-bg: rgba(248, 250, 252, 0.98);
      --modal-overlay-bg: rgba(15, 23, 42, 0.60);
      --modal-footer-bg: rgba(241, 245, 249, 0.95);
      --sidebar-backdrop-bg: rgba(15, 23, 42, 0.40);
      --disclaimer-bg: rgba(99, 102, 241, 0.06);
      --disclaimer-border: rgba(99, 102, 241, 0.18);
      --disclaimer-color: #4338CA;
      --text-strong: #4338CA;
      --text-code: #6D28D9;
      --code-bg: #EDE9FE;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      background: linear-gradient(160deg, var(--bg) 0%, var(--bg2) 100%);
      background-attachment: fixed;
      min-height: 100%;
    }

    body {
      background: transparent;
      color: var(--text);
      font-family: var(--sans);
      font-size: 16px;
      line-height: 1.65;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ── Disclaimer bar ── */
    .disclaimer-bar {
      background: var(--disclaimer-bg);
      border-bottom: 1px solid var(--disclaimer-border);
      padding: 9px 28px;
      font-size: 13px;
      color: var(--disclaimer-color);
      text-align: center;
      line-height: 1.5;
      letter-spacing: 0.01em;
    }

    /* ── Header ── */
    header {
      background: var(--header-bg);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border-bottom: 1px solid rgba(99, 102, 241, 0.22);
      padding: 0 28px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 64px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    /* Tri-colour top strip — mirrors card top strip */
    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(to right, var(--vibe1) 0%, var(--vibe2) 50%, var(--vibe3) 100%);
      pointer-events: none;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: inherit;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--vibe1), var(--vibe2));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      flex-shrink: 0;
      box-shadow: 0 0 14px rgba(99, 102, 241, 0.45);
    }

    .logo-text {
      font-size: 18px;
      font-weight: 700;
      color: var(--text);
      letter-spacing: -0.4px;
    }

    .logo-sub {
      font-size: 12px;
      color: var(--text-dim);
      font-weight: 400;
    }

    .header-right {
      font-size: 13px;
      color: var(--text-dim);
    }

    /* ── Layout ── */
    .layout {
      display: grid;
      grid-template-columns: 272px 1fr;
      min-height: calc(100vh - 64px);
    }

    /* ── Sidebar ── */
    .sidebar {
      background: var(--sidebar-bg);
      border-right: 1px solid var(--border);
      padding: 22px 0;
      overflow-y: auto;
      max-height: calc(100vh - 64px);
      position: sticky;
      top: 64px;
      backdrop-filter: blur(12px);
    }

    .sidebar-label {
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--text-dim);
      padding: 0 20px 12px;
    }

    .channel-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      cursor: pointer;
      transition: all 0.18s;
      border-left: 3px solid transparent;
    }

    .channel-item:hover {
      background: rgba(99, 102, 241, 0.07);
    }

    .channel-item.active {
      background: var(--vibe1-lt);
      border-left-color: var(--vibe2);
    }

    .channel-item.active .channel-name {
      color: var(--vibe1);
      font-weight: 600;
    }

    .channel-item.active .channel-meta {
      color: var(--vibe1);
      opacity: 0.65;
    }

    .channel-avatar {
      width: 38px;
      height: 38px;
      border-radius: 10px;
      background: rgba(99, 102, 241, 0.12);
      overflow: hidden;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--vibe1);
      border: 1px solid var(--border);
    }

    .channel-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .channel-info {
      min-width: 0;
      flex: 1;
    }

    .channel-name {
      font-size: 15px;
      font-weight: 500;
      color: var(--text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .channel-meta {
      font-size: 13px;
      color: var(--text-dim);
      margin-top: 2px;
    }

    .sidebar-divider {
      height: 1px;
      background: var(--border);
      margin: 14px 0;
    }

    /* ── Main Content ── */
    .main {
      padding: 32px 36px;
    }

    .page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 28px;
      gap: 16px;
    }

    .page-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--text);
      letter-spacing: -0.6px;
    }

    .stats-bar {
      display: flex;
      gap: 12px;
      margin-bottom: 28px;
      flex-wrap: wrap;
    }

    .stat-chip {
      display: flex;
      align-items: center;
      gap: 7px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 7px 16px;
      font-size: 14px;
      color: var(--text-muted);
      font-weight: 500;
    }

    .stat-chip svg {
      color: var(--vibe1);
      flex-shrink: 0;
    }

    .stat-chip strong {
      color: var(--text);
    }

    /* ── Episodes Grid ── */
    .episodes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 18px;
    }

    .episode-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-left: 3px solid transparent;
      border-radius: var(--radius);
      padding: 22px;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow-sm);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .episode-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-4px);
      border-left-color: var(--vibe2);
      border-color: var(--border-hover);
    }

    .episode-card-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .episode-channel-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: var(--vibe1-lt);
      color: var(--vibe1);
      font-size: 12px;
      font-weight: 600;
      padding: 4px 11px;
      border-radius: 20px;
      letter-spacing: 0.3px;
      border: 1px solid rgba(99, 102, 241, 0.25);
    }

    .episode-title {
      font-size: 17px;
      font-weight: 600;
      line-height: 1.5;
      color: var(--text);
      letter-spacing: -0.2px;
    }

    .episode-hashtags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 6px 0 2px;
    }

    .hashtag {
      font-size: 11px;
      font-weight: 500;
      color: var(--vibe2);
      background: rgba(168, 85, 247, 0.1);
      border: 1px solid rgba(168, 85, 247, 0.22);
      border-radius: 20px;
      padding: 2px 8px;
      letter-spacing: 0.2px;
      white-space: nowrap;
    }

    .modal-hashtags {
      display: flex;
      flex-wrap: wrap;
      gap: 7px;
      margin-top: 10px;
    }

    .modal-hashtags .hashtag {
      font-size: 12px;
      padding: 3px 10px;
    }

    .episode-date {
      font-size: 13px;
      color: var(--text-dim);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .episode-arrow {
      color: var(--vibe2);
      opacity: 0;
      transition: opacity 0.2s, transform 0.2s;
      align-self: flex-end;
      margin-top: auto;
      display: flex;
      align-items: center;
    }

    .episode-card:hover .episode-arrow {
      opacity: 1;
      transform: translateX(4px);
    }

    .empty-state {
      grid-column: 1 / -1;
      text-align: center;
      padding: 90px 20px;
    }

    .empty-icon {
      margin-bottom: 20px;
      display: flex;
      justify-content: center;
      color: var(--text-dim);
    }

    .empty-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 10px;
    }

    .empty-text {
      font-size: 16px;
      color: var(--text-muted);
      line-height: 1.8;
    }

    /* ── Loading ── */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 90px;
      color: var(--text-muted);
      font-size: 16px;
      gap: 12px;
    }

    .spinner {
      width: 22px;
      height: 22px;
      border: 2px solid var(--border);
      border-top-color: var(--vibe1);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* ── Summary Modal ── */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: var(--modal-overlay-bg);
      z-index: 200;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .modal-overlay.open {
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 44px 20px;
      overflow-y: auto;
    }

    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 18px;
      width: 100%;
      max-width: 880px;
      box-shadow: var(--shadow-lg);
      animation: slideIn 0.24s ease;
      position: relative;
      overflow: hidden;
    }

    /* Tri-colour top strip on modal */
    .modal::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(to right, var(--vibe1), var(--vibe2), var(--vibe3));
      z-index: 1;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(18px) scale(0.99);
      }

      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      padding: 32px 36px 26px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: flex-start;
      gap: 16px;
      background: linear-gradient(to bottom, rgba(99, 102, 241, .06), transparent);
    }

    .modal-title-block {
      flex: 1;
    }

    .modal-channel {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: var(--vibe1-lt);
      color: var(--vibe1);
      font-size: 12px;
      font-weight: 600;
      padding: 4px 11px;
      border-radius: 20px;
      margin-bottom: 12px;
      border: 1px solid rgba(99, 102, 241, 0.25);
    }

    .modal-title {
      font-size: 24px;
      font-weight: 700;
      line-height: 1.4;
      letter-spacing: -0.4px;
      color: var(--text);
    }

    .modal-meta {
      font-size: 14px;
      color: var(--text-dim);
      margin-top: 9px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .modal-close {
      background: rgba(99, 102, 241, 0.10);
      border: 1px solid var(--border);
      border-radius: 9px;
      color: var(--text-muted);
      cursor: pointer;
      padding: 8px;
      line-height: 0;
      flex-shrink: 0;
      transition: all 0.15s;
      display: flex;
      align-items: center;
    }

    .modal-close:hover {
      background: var(--red-lt);
      color: var(--red);
      border-color: rgba(244, 63, 94, 0.35);
    }

    .modal-body {
      padding: 36px;
      max-height: 60vh;
      overflow-y: auto;
    }

    .modal-body::-webkit-scrollbar {
      width: 5px;
    }

    .modal-body::-webkit-scrollbar-track {
      background: var(--surface2);
    }

    .modal-body::-webkit-scrollbar-thumb {
      background: var(--vibe1);
      border-radius: 3px;
    }

    .modal-body h1 {
      display: none;
    }

    .modal-body h2 {
      font-size: 17px;
      font-weight: 700;
      color: var(--vibe1);
      margin: 30px 0 14px;
      padding: 10px 16px;
      background: rgba(99, 102, 241, 0.10);
      border-radius: var(--radius-sm);
      border-left: 3px solid var(--vibe2);
    }

    .modal-body h2:first-of-type {
      margin-top: 0;
    }

    .modal-body p {
      font-size: 16px;
      line-height: 1.9;
      color: var(--text);
      margin-bottom: 12px;
    }

    .modal-body ul,
    .modal-body ol {
      padding-left: 24px;
      margin-bottom: 16px;
    }

    .modal-body li {
      font-size: 16px;
      line-height: 1.9;
      color: var(--text);
      margin-bottom: 7px;
    }

    .modal-body strong {
      color: var(--text-strong);
      font-weight: 600;
    }

    .modal-body a {
      color: var(--vibe1);
      text-decoration: none;
    }

    .modal-body a:hover {
      color: var(--vibe2);
      text-decoration: underline;
    }

    .modal-body code {
      font-family: 'IBM Plex Mono', 'SF Mono', monospace;
      background: var(--code-bg);
      border: 1px solid var(--border);
      padding: 2px 7px;
      font-size: 14px;
      border-radius: 5px;
      color: var(--text-code);
    }

    /* ── Cards Strip ── */
    .cards-strip {
      padding: 22px 36px 0;
      border-bottom: 1px solid var(--border);
    }

    .cards-strip-label {
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--text-dim);
      margin-bottom: 14px;
    }

    .cards-scroll {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding-bottom: 18px;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }

    .cards-scroll::-webkit-scrollbar {
      height: 4px;
    }

    .cards-scroll::-webkit-scrollbar-track {
      background: var(--surface2);
      border-radius: 2px;
    }

    .cards-scroll::-webkit-scrollbar-thumb {
      background: var(--vibe1);
      border-radius: 2px;
    }

    .card-thumb {
      flex-shrink: 0;
      scroll-snap-align: start;
      width: 96px;
      border-radius: 9px;
      overflow: hidden;
      border: 2px solid var(--border);
      cursor: pointer;
      transition: border-color 0.15s, transform 0.18s, box-shadow 0.18s;
    }

    .card-thumb:hover {
      border-color: var(--vibe2);
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(168, 85, 247, 0.3);
    }

    .card-thumb img {
      width: 100%;
      display: block;
    }

    /* ── Lightbox ── */
    .lightbox {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.94);
      z-index: 400;
      align-items: center;
      justify-content: center;
      padding: 20px;
      cursor: zoom-out;
    }

    .lightbox.open {
      display: flex;
    }

    .lightbox img {
      max-height: 92vh;
      max-width: 92vw;
      object-fit: contain;
      border-radius: 10px;
      box-shadow: 0 0 80px rgba(99, 102, 241, 0.3);
      cursor: default;
      animation: lbIn 0.18s ease;
    }

    @keyframes lbIn {
      from {
        opacity: 0;
        transform: scale(0.92);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .lightbox-close,
    .lightbox-nav {
      background: rgba(99, 102, 241, 0.15);
      border: 1px solid rgba(99, 102, 241, 0.3);
      color: white;
      line-height: 0;
      padding: 11px;
      border-radius: 9px;
      cursor: pointer;
      transition: background 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .lightbox-close:hover,
    .lightbox-nav:hover {
      background: rgba(99, 102, 241, 0.35);
    }

    .lightbox-close {
      position: fixed;
      top: 18px;
      right: 22px;
    }

    .lightbox-nav {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
    }

    .lightbox-prev {
      left: 18px;
    }

    .lightbox-next {
      right: 18px;
    }

    .lightbox-counter {
      position: fixed;
      bottom: 22px;
      left: 50%;
      transform: translateX(-50%);
      color: rgba(255, 255, 255, 0.55);
      font-size: 14px;
      font-family: var(--sans);
    }

    /* ── Modal Footer ── */
    .modal-footer {
      padding: 22px 36px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 10px;
      align-items: center;
      background: var(--modal-footer-bg);
      border-radius: 0 0 18px 18px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 7px;
      font-family: var(--sans);
      font-size: 15px;
      font-weight: 600;
      padding: 10px 20px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.18s;
      text-decoration: none;
      border: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--vibe1), var(--vibe2));
      color: white;
      box-shadow: 0 3px 12px rgba(99, 102, 241, 0.4);
    }

    .btn-primary:hover {
      filter: brightness(1.12);
      box-shadow: 0 5px 20px rgba(99, 102, 241, 0.55);
      color: white;
    }

    .btn-ghost {
      background: rgba(99, 102, 241, 0.08);
      color: var(--text-muted);
      border: 1px solid var(--border);
    }

    .btn-ghost:hover {
      background: rgba(99, 102, 241, 0.14);
      color: var(--text);
      border-color: var(--vibe1);
    }

    /* ── Mobile ── */
    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      cursor: pointer;
      color: var(--text-muted);
      padding: 7px;
      border-radius: 7px;
      line-height: 0;
      transition: background 0.15s;
    }

    .mobile-menu-btn:hover {
      background: rgba(99, 102, 241, 0.12);
    }

    @media (max-width: 768px) {
      .layout {
        grid-template-columns: 1fr;
      }

      .mobile-menu-btn {
        display: flex;
      }

      .sidebar {
        position: fixed;
        top: 64px;
        left: -272px;
        width: 272px;
        height: calc(100vh - 64px);
        transition: left 0.25s ease;
        z-index: 150;
        box-shadow: var(--shadow-lg);
      }

      .sidebar.open {
        left: 0;
      }

      .sidebar-backdrop {
        display: none;
        position: fixed;
        inset: 0;
        top: 64px;
        background: var(--sidebar-backdrop-bg);
        z-index: 140;
      }

      .sidebar-backdrop.open {
        display: block;
      }

      .main {
        padding: 22px 18px;
      }

      .page-title {
        font-size: 24px;
      }

      .modal-overlay {
        padding: 0;
        align-items: flex-end;
      }

      .modal {
        border-radius: 18px 18px 0 0;
        max-height: 91vh;
        animation: slideUp 0.26s ease;
      }

      @keyframes slideUp {
        from {
          transform: translateY(100%);
        }

        to {
          transform: translateY(0);
        }
      }

      .modal-body {
        max-height: 56vh;
      }

      .modal-header {
        padding: 22px 22px 18px;
      }

      .cards-strip {
        padding: 18px 22px 0;
      }

      .modal-body {
        padding: 22px;
      }

      .modal-footer {
        padding: 18px 22px;
      }

      .modal-title {
        font-size: 20px;
      }

      .episodes-grid {
        grid-template-columns: 1fr;
      }
    }

    /* ── Theme toggle button ── */
    .theme-toggle {
      background: none;
      border: 1px solid var(--border);
      border-radius: 9px;
      color: var(--text-muted);
      cursor: pointer;
      padding: 7px;
      line-height: 0;
      transition: background 0.18s, border-color 0.18s, color 0.18s;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .theme-toggle:hover {
      background: var(--vibe1-lt);
      border-color: var(--vibe1);
      color: var(--vibe1);
    }

    .theme-toggle .icon-sun,
    .theme-toggle .icon-moon {
      display: none;
    }

    html[data-theme="light"] .theme-toggle .icon-moon {
      display: block;
    }

    html:not([data-theme="light"]) .theme-toggle .icon-sun {
      display: block;
    }

    /* ── Header right area ── */
    .header-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* ── html transition for smooth theme switch ── */
    html {
      transition: background 0.25s ease;
    }

    body, header, .sidebar, .episode-card, .modal, .stat-chip, .hashtag {
      transition: background-color 0.25s ease, border-color 0.25s ease, color 0.25s ease;
    }
  </style>
</head>

<body>

  <header>
    <a class="logo" href="#/">
      <div class="logo-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
          stroke-linecap="round" stroke-linejoin="round" width="18" height="18">
          <polyline points="22 7 13.5 15.5 8.5 10.5 2 17" />
          <polyline points="16 7 22 7 22 13" />
        </svg>
      </div>
      <div>
        <div class="logo-text">Ultra Investment Digest</div>
        <div class="logo-sub">財經投資頻道重點摘要</div>
      </div>
    </a>
    <div class="header-actions">
      <div class="header-right" id="lastUpdated"></div>
      <button class="theme-toggle" id="themeToggle" aria-label="切換主題">
        <!-- Sun icon (shown in dark mode → click to go light) -->
        <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="18" height="18">
          <circle cx="12" cy="12" r="5"/>
          <line x1="12" y1="1" x2="12" y2="3"/>
          <line x1="12" y1="21" x2="12" y2="23"/>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
          <line x1="1" y1="12" x2="3" y2="12"/>
          <line x1="21" y1="12" x2="23" y2="12"/>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
        <!-- Moon icon (shown in light mode → click to go dark) -->
        <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="18" height="18">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
      </button>
      <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="選單">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round" width="22" height="22">
          <line x1="3" y1="12" x2="21" y2="12" />
          <line x1="3" y1="6" x2="21" y2="6" />
          <line x1="3" y1="18" x2="21" y2="18" />
        </svg>
      </button>
    </div>
  </header>

  <div class="disclaimer-bar">
    聲明：本摘要網頁由 AI 生成，僅供複習筆記之用，建議聽完整部影片，並以自身觀點評估股市，謝謝
  </div>

  <div class="sidebar-backdrop" id="sidebarBackdrop"></div>

  <div class="layout">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-label">頻道</div>
      <div id="channelList"></div>
    </aside>

    <main class="main">
      <div id="mainContent">
        <div class="loading">
          <div class="spinner"></div> 載入中…
        </div>
      </div>
    </main>
  </div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox">
    <button class="lightbox-close" id="lbClose" aria-label="關閉">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
        stroke-linecap="round" stroke-linejoin="round" width="18" height="18">
        <line x1="18" y1="6" x2="6" y2="18" />
        <line x1="6" y1="6" x2="18" y2="18" />
      </svg>
    </button>
    <button class="lightbox-nav lightbox-prev" id="lbPrev" aria-label="上一張">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
        stroke-linecap="round" stroke-linejoin="round" width="24" height="24">
        <polyline points="15 18 9 12 15 6" />
      </svg>
    </button>
    <img id="lbImg" src="" alt="字卡">
    <button class="lightbox-nav lightbox-next" id="lbNext" aria-label="下一張">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
        stroke-linecap="round" stroke-linejoin="round" width="24" height="24">
        <polyline points="9 18 15 12 9 6" />
      </svg>
    </button>
    <div class="lightbox-counter" id="lbCounter"></div>
  </div>

  <!-- Summary Modal -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal" id="modal">
      <div class="modal-header">
        <div class="modal-title-block">
          <div class="modal-channel" id="modalChannel"></div>
          <div class="modal-title" id="modalTitle"></div>
          <div class="modal-hashtags" id="modalHashtags" style="display:none"></div>
          <div class="modal-meta" id="modalMeta"></div>
        </div>
        <button class="modal-close" id="modalClose" aria-label="關閉">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
      </div>
      <div class="cards-strip" id="cardsStrip" style="display:none">
        <div class="cards-strip-label">精華字卡</div>
        <div class="cards-scroll" id="cardsScroll"></div>
      </div>
      <div class="modal-body" id="modalBody">
        <div class="loading">
          <div class="spinner"></div> 載入中…
        </div>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary" id="modalYtLink" href="#" target="_blank" rel="noopener">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
            <polygon points="5 3 19 12 5 21 5 3" />
          </svg>
          YouTube 觀看原片
        </a>
        <button class="btn btn-ghost" id="modalCloseBtn">關閉</button>
      </div>
    </div>
  </div>

  <script>
    // ── Config ─────────────────────────────────────────────────

    const BASE = (() => {
      const path = location.pathname.replace(/\/[^/]*$/, '/');
      return path.endsWith('/') ? path : path + '/';
    })();

    // ── SVG Icons ──────────────────────────────────────────────

    const ICONS = {
      chart: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="18" height="18"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>`,
      tv: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="18" height="18"><rect x="2" y="7" width="20" height="15" rx="2" ry="2"/><polyline points="17 2 12 7 7 2"/></svg>`,
      calendar: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="13" height="13"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>`,
      doc: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="15" height="15"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>`,
      arrowRight: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="17" height="17"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>`,
      inbox: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" width="56" height="56"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/></svg>`,
      alertCircle: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" width="56" height="56"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>`,
    };

    // ── State ──────────────────────────────────────────────────

    let allEpisodes = [];
    let generatedAt = '';

    // ── Helpers ────────────────────────────────────────────────

    function stripFrontmatter(md) {
      if (!md.startsWith('---')) return md;
      const end = md.indexOf('---', 3);
      if (end === -1) return md;
      return md.slice(end + 3).replace(/^\n+/, '');
    }

    function fmt(dateStr) {
      if (!dateStr) return '';
      if (!/^\d{4}-\d{2}-\d{2}/.test(dateStr)) return dateStr;
      try {
        return new Date(dateStr).toLocaleDateString('zh-TW', { year: 'numeric', month: 'long', day: 'numeric' });
      } catch { return dateStr; }
    }

    function channelIcon(name) {
      if (!name) return ICONS.tv;
      const n = name.toLowerCase();
      if (n.includes('股癌') || n.includes('gooaye')) return ICONS.chart;
      return ICONS.tv;
    }

    // ── Data Fetch ─────────────────────────────────────────────

    async function loadData() {
      const resp = await fetch(BASE + 'data/episodes.json');
      if (!resp.ok) throw new Error('Failed to load episodes.json');
      const data = await resp.json();
      allEpisodes = data.episodes || [];
      generatedAt = data.generated_at || '';

      const el = document.getElementById('lastUpdated');
      if (generatedAt) {
        const d = new Date(generatedAt + 'Z');
        el.textContent = '更新：' + d.toLocaleDateString('zh-TW');
      }
    }

    // ── Routing ────────────────────────────────────────────────

    function getRoute() {
      const hash = location.hash || '#/';
      if (hash.startsWith('#/channel/')) {
        return { type: 'channel', id: decodeURIComponent(hash.slice(10)) };
      }
      return { type: 'all' };
    }

    // ── Sidebar ────────────────────────────────────────────────

    function renderSidebar(episodes, activeChannelId) {
      const channelMap = new Map();
      for (const ep of episodes) {
        if (!channelMap.has(ep.channel_id)) {
          channelMap.set(ep.channel_id, { name: ep.channel_name, count: 0, thumbnail: ep.channel_thumbnail });
        }
        channelMap.get(ep.channel_id).count++;
      }

      const allActive = !activeChannelId;
      let html = `
    <div class="channel-item ${allActive ? 'active' : ''}" data-channel="">
      <div class="channel-avatar">${ICONS.chart}</div>
      <div class="channel-info">
        <div class="channel-name">全部頻道</div>
        <div class="channel-meta">${episodes.length} 集</div>
      </div>
    </div>
    <div class="sidebar-divider"></div>
  `;

      for (const [cid, info] of channelMap) {
        const active = cid === activeChannelId;
        const thumb = info.thumbnail
          ? `<img src="${info.thumbnail}" alt="${info.name}" loading="lazy">`
          : channelIcon(info.name);
        html += `
      <div class="channel-item ${active ? 'active' : ''}" data-channel="${cid}">
        <div class="channel-avatar">${thumb}</div>
        <div class="channel-info">
          <div class="channel-name">${info.name || cid}</div>
          <div class="channel-meta">${info.count} 集</div>
        </div>
      </div>
    `;
      }

      document.getElementById('channelList').innerHTML = html;

      document.querySelectorAll('.channel-item').forEach(el => {
        el.addEventListener('click', () => {
          const cid = el.dataset.channel;
          location.hash = cid ? `#/channel/${encodeURIComponent(cid)}` : '#/';
          closeSidebar();
        });
      });
    }

    // ── Main Content ───────────────────────────────────────────

    function renderEpisodes(episodes, title) {
      if (!episodes.length) {
        document.getElementById('mainContent').innerHTML = `
      <div class="page-header"><h1 class="page-title">${title}</h1></div>
      <div class="episodes-grid">
        <div class="empty-state">
          <div class="empty-icon">${ICONS.inbox}</div>
          <div class="empty-title">還沒有摘要</div>
          <div class="empty-text">在本機執行 <code>python3 runner.py run</code> 後再部署即可。</div>
        </div>
      </div>
    `;
        return;
      }

      let cards = '';
      for (const ep of episodes) {
        const date = fmt(ep.published_at || ep.processed_at);
        const cardsJson = JSON.stringify(ep.cards || []).replace(/"/g, '&quot;');
        const hashtagsHtml = (ep.hashtags || '').split(/\s+/).filter(t => t)
          .map(t => `<span class="hashtag">${t}</span>`).join('');
        cards += `
      <div class="episode-card" data-video-id="${ep.video_id}"
           data-channel-name="${ep.channel_name || ''}"
           data-channel-id="${ep.channel_id || ''}"
           data-date="${date}"
           data-summary-url="${ep.summary_url}"
           data-cards="${cardsJson}"
           data-hashtags="${(ep.hashtags || '').replace(/"/g, '&quot;')}">
        <div class="episode-card-top">
          <span class="episode-channel-badge">${ep.channel_name || ep.channel_id}</span>
        </div>
        <div class="episode-title">${ep.title}</div>
        ${hashtagsHtml ? `<div class="episode-hashtags">${hashtagsHtml}</div>` : ''}
        <div class="episode-date">${ICONS.calendar} ${date}</div>
        <div class="episode-arrow">${ICONS.arrowRight}</div>
      </div>
    `;
      }

      document.getElementById('mainContent').innerHTML = `
    <div class="page-header">
      <h1 class="page-title">${title}</h1>
    </div>
    <div class="stats-bar">
      <div class="stat-chip">${ICONS.doc} <strong>${episodes.length}</strong> 集摘要</div>
    </div>
    <div class="episodes-grid">${cards}</div>
  `;

      document.querySelectorAll('.episode-card').forEach(card => {
        card.addEventListener('click', () => {
          openModal({
            videoId: card.dataset.videoId,
            channelName: card.dataset.channelName,
            title: card.querySelector('.episode-title').textContent,
            date: card.dataset.date,
            summaryUrl: card.dataset.summaryUrl,
            cards: card.dataset.cards ? JSON.parse(card.dataset.cards) : [],
            hashtags: card.dataset.hashtags || '',
          });
        });
      });
    }

    // ── Modal ──────────────────────────────────────────────────

    async function openModal({ videoId, channelName, title, date, summaryUrl, cards, hashtags }) {
      const overlay = document.getElementById('modalOverlay');
      const body = document.getElementById('modalBody');
      const strip = document.getElementById('cardsStrip');
      const scroll = document.getElementById('cardsScroll');

      document.getElementById('modalChannel').textContent = channelName;
      document.getElementById('modalTitle').textContent = title;

      const hashtagsEl = document.getElementById('modalHashtags');
      if (hashtags) {
        hashtagsEl.innerHTML = hashtags.split(/\s+/).filter(t => t)
          .map(t => `<span class="hashtag">${t}</span>`).join('');
        hashtagsEl.style.display = 'flex';
      } else {
        hashtagsEl.innerHTML = '';
        hashtagsEl.style.display = 'none';
      }

      const metaEl = document.getElementById('modalMeta');
      metaEl.innerHTML = date ? `${ICONS.calendar} ${date}` : '';
      document.getElementById('modalYtLink').href = `https://youtube.com/watch?v=${videoId}`;
      body.innerHTML = '<div class="loading"><div class="spinner"></div> 載入中…</div>';

      if (cards && cards.length) {
        scroll.innerHTML = cards.map((url, i) =>
          `<div class="card-thumb" data-index="${i}">
        <img src="${BASE + url}" alt="字卡 ${i + 1}" loading="lazy">
      </div>`
        ).join('');
        strip.style.display = 'block';
        scroll.querySelectorAll('.card-thumb').forEach(thumb => {
          thumb.addEventListener('click', () => openLightbox(cards, +thumb.dataset.index));
        });
      } else {
        strip.style.display = 'none';
        scroll.innerHTML = '';
      }

      overlay.classList.add('open');
      document.body.style.overflow = 'hidden';

      try {
        const resp = await fetch(BASE + summaryUrl);
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const md = await resp.text();
        const bodyMd = stripFrontmatter(md);
        body.innerHTML = marked.parse(bodyMd);
        body.querySelectorAll('a').forEach(a => { a.target = '_blank'; a.rel = 'noopener'; });
      } catch (e) {
        body.innerHTML = `<p style="color:var(--red)">⚠️ 載入摘要失敗：${e.message}</p>`;
      }
    }

    function closeModal() {
      document.getElementById('modalOverlay').classList.remove('open');
      document.body.style.overflow = '';
    }

    // ── Mobile Sidebar ─────────────────────────────────────────

    function openSidebar() {
      document.getElementById('sidebar').classList.add('open');
      document.getElementById('sidebarBackdrop').classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeSidebar() {
      document.getElementById('sidebar').classList.remove('open');
      document.getElementById('sidebarBackdrop').classList.remove('open');
      document.body.style.overflow = '';
    }

    // ── Router ─────────────────────────────────────────────────

    function route() {
      const r = getRoute();
      let filtered, title;

      if (r.type === 'channel') {
        filtered = allEpisodes.filter(e => e.channel_id === r.id);
        const ch = allEpisodes.find(e => e.channel_id === r.id);
        title = ch ? ch.channel_name : r.id;
      } else {
        filtered = allEpisodes;
        title = '全部節目';
      }

      renderSidebar(allEpisodes, r.type === 'channel' ? r.id : null);
      renderEpisodes(filtered, title);
    }

    // ── Init ───────────────────────────────────────────────────

    (async () => {
      try {
        await loadData();
        route();
      } catch (e) {
        document.getElementById('mainContent').innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">${ICONS.alertCircle}</div>
        <div class="empty-title">載入失敗</div>
        <div class="empty-text">${e.message}</div>
      </div>
    `;
      }
    })();

    // ── Lightbox ──────────────────────────────────────────────

    let lbCards = [];
    let lbIndex = 0;

    function openLightbox(cards, index) {
      lbCards = cards;
      lbIndex = index;
      _lbShow();
      document.getElementById('lightbox').classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
      document.getElementById('lightbox').classList.remove('open');
      document.body.style.overflow = '';
    }

    function _lbShow() {
      document.getElementById('lbImg').src = BASE + lbCards[lbIndex];
      document.getElementById('lbCounter').textContent = `${lbIndex + 1} / ${lbCards.length}`;
      document.getElementById('lbPrev').style.visibility = lbIndex > 0 ? 'visible' : 'hidden';
      document.getElementById('lbNext').style.visibility = lbIndex < lbCards.length - 1 ? 'visible' : 'hidden';
    }

    document.getElementById('lbClose').addEventListener('click', closeLightbox);
    document.getElementById('lightbox').addEventListener('click', e => {
      if (e.target === document.getElementById('lightbox')) closeLightbox();
    });
    document.getElementById('lbPrev').addEventListener('click', e => {
      e.stopPropagation();
      if (lbIndex > 0) { lbIndex--; _lbShow(); }
    });
    document.getElementById('lbNext').addEventListener('click', e => {
      e.stopPropagation();
      if (lbIndex < lbCards.length - 1) { lbIndex++; _lbShow(); }
    });

    window.addEventListener('hashchange', route);

    document.getElementById('modalClose').addEventListener('click', closeModal);
    document.getElementById('modalCloseBtn').addEventListener('click', closeModal);
    document.getElementById('modalOverlay').addEventListener('click', e => {
      if (e.target === document.getElementById('modalOverlay')) closeModal();
    });
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') {
        if (document.getElementById('lightbox').classList.contains('open')) closeLightbox();
        else closeModal();
      }
      if (document.getElementById('lightbox').classList.contains('open')) {
        if (e.key === 'ArrowLeft' && lbIndex > 0) { lbIndex--; _lbShow(); }
        if (e.key === 'ArrowRight' && lbIndex < lbCards.length - 1) { lbIndex++; _lbShow(); }
      }
    });

    document.getElementById('mobileMenuBtn').addEventListener('click', openSidebar);
    document.getElementById('sidebarBackdrop').addEventListener('click', closeSidebar);

    // ── Theme Toggle ───────────────────────────────────────────

    function getInitialTheme() {
      const saved = localStorage.getItem('theme');
      if (saved === 'light' || saved === 'dark') return saved;
      return window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
    }

    function applyTheme(theme) {
      if (theme === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
      } else {
        document.documentElement.removeAttribute('data-theme');
      }
      localStorage.setItem('theme', theme);
    }

    // Apply on load without transition flicker
    (function () {
      const theme = getInitialTheme();
      applyTheme(theme);
    })();

    document.getElementById('themeToggle').addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme');
      applyTheme(current === 'light' ? 'dark' : 'light');
    });
  </script>
</body>

</html>